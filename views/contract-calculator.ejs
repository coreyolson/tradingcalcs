<%- include('partials/header', { 
    title: 'Contract Trading Calculator',
    description: 'Risk Analysis & Monte Carlo Simulation',
    includeChartJs: true
}) %>

        <!-- Page Header -->
        <div class="container-fluid px-4 mb-4">
            <h1 class="page-title">
                <i class="fas fa-chart-line"></i>
                Contract Trading Calculator
            </h1>
            <p class="page-subtitle">Risk Analysis & Monte Carlo Simulation</p>
        </div>

        <div class="container-fluid px-4">
            <div class="row g-3">
                <!-- Left Column: Input Controls -->
                <div class="col-xl-3 col-lg-4">
                    <div class="card input-card">
                        <div class="card-header">
                            <i class="fas fa-sliders-h"></i> Parameters
                        </div>
                        <div class="card-body compact-form">
                            <form id="calculatorForm">
                                <div class="input-row">
                                    <label>Account ($)</label>
                                    <input type="number" class="form-control form-control-sm" id="accountSize" value="3125" min="100" step="100">
                                </div>

                                <div class="input-row">
                                    <label>Risk (%)</label>
                                    <input type="number" class="form-control form-control-sm" id="riskPercent" value="8" min="1" max="95" step="1">
                                    <small class="text-warning" style="font-size: 0.7rem; display: none;" id="riskWarning">
                                        <i class="fas fa-exclamation-triangle"></i> Risk capped at 95%
                                    </small>
                                </div>

                                <div class="input-row">
                                    <label>Win Rate (%)</label>
                                    <input type="number" class="form-control form-control-sm" id="winRate" value="80" min="1" max="100" step="1">
                                </div>

                                <div class="input-row">
                                    <label>Avg Win (%)</label>
                                    <input type="number" class="form-control form-control-sm" id="avgWin" value="50" min="1" max="10000" step="1">
                                </div>

                                <div class="input-row">
                                    <label>Avg Loss (%)</label>
                                    <input type="number" class="form-control form-control-sm" id="avgLoss" value="30" min="1" max="100" step="1">
                                </div>

                                <div class="input-row">
                                    <label>Stop Loss (%)</label>
                                    <input type="number" class="form-control form-control-sm" id="stopLoss" value="50" min="1" max="100" step="1">
                                </div>

                                <div class="input-row">
                                    <label>Contract Price ($)</label>
                                    <input type="number" class="form-control form-control-sm" id="contractPrice" value="1.00" min="0.01" max="100" step="0.01">
                                </div>

                                <div class="input-row">
                                    <label>Commission ($)</label>
                                    <input type="number" class="form-control form-control-sm" id="commission" value="0.65" min="0" max="10" step="0.01">
                                </div>

                                <div class="input-row">
                                    <label>Trades/Day</label>
                                    <input type="number" class="form-control form-control-sm" id="tradesPerDay" value="2" min="1" max="50" step="1">
                                </div>

                                <div class="input-row">
                                    <label>Days</label>
                                    <input type="number" class="form-control form-control-sm" id="days" value="30" min="1" max="500" step="1">
                                </div>

                                <div class="input-row">
                                    <label>
                                        Contract Step
                                        <i class="fas fa-info-circle text-muted" style="font-size: 0.7rem;" title="Round contract size to nearest multiple (e.g., 1, 5, 10)"></i>
                                    </label>
                                    <input type="number" class="form-control form-control-sm" id="contractStep" value="1" min="1" max="100" step="1">
                                </div>

                                <hr class="my-3" style="border-color: var(--border-accent); opacity: 0.3;">
                                
                                <!-- Presets Section Inside Parameters -->
                                <div class="presets-section mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label class="mb-0" style="font-size: 0.85rem; font-weight: 600; color: var(--primary-color);">
                                            <i class="fas fa-bookmark"></i> Presets
                                        </label>
                                        <button class="btn btn-sm btn-outline-success" id="savePresetBtn" style="font-size: 0.65rem; padding: 0.15rem 0.4rem;">
                                            <i class="fas fa-plus"></i> Save
                                        </button>
                                    </div>
                                    <div class="row g-1">
                                        <div class="col-4">
                                            <button class="btn btn-sm btn-preset w-100" data-preset="conservative">
                                                <i class="fas fa-shield-alt"></i><br><small>Conservative</small>
                                            </button>
                                        </div>
                                        <div class="col-4">
                                            <button class="btn btn-sm btn-preset w-100" data-preset="moderate">
                                                <i class="fas fa-balance-scale"></i><br><small>Moderate</small>
                                            </button>
                                        </div>
                                        <div class="col-4">
                                            <button class="btn btn-sm btn-preset w-100" data-preset="aggressive">
                                                <i class="fas fa-rocket"></i><br><small>Aggressive</small>
                                            </button>
                                        </div>
                                    </div>
                                    <div id="customPresetsContainer" class="mt-2">
                                        <!-- Custom presets will be added here -->
                                    </div>
                                </div>

                                <div class="d-grid gap-2 mt-3">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-calculator"></i> Calculate
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="resetBtn">
                                        <i class="fas fa-undo"></i> Reset
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>

                <!-- Right Column: Results & Visualizations -->
                <div class="col-xl-9 col-lg-8">
                    <!-- Loading Indicator -->
                    <div id="loadingIndicator" class="text-center py-4 d-none">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Calculating...</span>
                        </div>
                        <p class="mt-2 text-muted">Running Monte Carlo...</p>
                    </div>

                    <!-- Results Container -->
                    <div id="resultsContainer" class="d-none">
                        <!-- Trade Summary Card -->
                        <div class="card mb-3 trade-summary-card">
                            <div class="card-header">
                                <i class="fas fa-clipboard-list"></i> Trade Setup Summary
                            </div>
                            <div class="card-body p-3">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="summary-metric">
                                            <div class="summary-label">Contract Size</div>
                                            <div class="summary-value" id="contractSize">--</div>
                                            <div class="summary-desc" id="contractDesc">calculating...</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="summary-metric">
                                            <div class="summary-label">Entry Cost</div>
                                            <div class="summary-value text-info" id="entryCost">--</div>
                                            <div class="summary-desc">per trade (incl. fees)</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="summary-metric">
                                            <div class="summary-label">Stop Loss</div>
                                            <div class="summary-value text-danger" id="stopLossCost">--</div>
                                            <div class="summary-desc">max loss per trade</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-3 mt-1">
                                    <div class="col-md-4">
                                        <div class="summary-metric">
                                            <div class="summary-label">Win Target</div>
                                            <div class="summary-value text-success" id="winTarget">--</div>
                                            <div class="summary-desc">profit at target</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="summary-metric">
                                            <div class="summary-label">Daily Fees</div>
                                            <div class="summary-value text-warning" id="dailyFees">--</div>
                                            <div class="summary-desc" id="feesDesc">round trip costs</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="summary-metric">
                                            <div class="summary-label">Break-Even Win Rate</div>
                                            <div class="summary-value" id="breakEvenWinRate">--</div>
                                            <div class="summary-desc">after fees</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Compact Metrics Grid -->
                        <div class="metrics-grid mb-3">
                            <div class="metric-box" 
                                 data-help-title="Expected Value (EV)" 
                                 data-help-text="The average percentage profit/loss per trade based on your win rate and payoff ratio."
                                 data-help-example="If your EV is 35%, you can expect to make an average of 35% profit on your risk amount per trade."
                                 data-help-good="Good: >30% | Great: >40% | Excellent: >50%"
                                 data-help-why="This is your most important metric - it tells you if your strategy is profitable. A positive EV means you make money over time, negative EV means you lose money.">
                                <div class="metric-label">
                                    EV
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value text-success" id="evValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Win Rate" 
                                 data-help-text="The percentage of your trades that are profitable (winners vs total trades)."
                                 data-help-example="A 60% win rate means 6 out of every 10 trades are winners."
                                 data-help-good="Depends on strategy: High R:R strategies may have 30-40% win rate, scalping strategies need 60-70%+"
                                 data-help-why="Win rate alone doesn't determine profitability - you need to combine it with your payoff ratio. You can be profitable with a 30% win rate if your winners are much bigger than your losers.">
                                <div class="metric-label">
                                    Win Rate
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value text-info" id="winRateMetric">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Payoff Ratio (R:R)" 
                                 data-help-text="Average win size divided by average loss size. This shows how much you make when you win vs how much you lose when you lose."
                                 data-help-example="A 2.0 payoff means your average win is twice as large as your average loss. If you risk $100, your average win is $200."
                                 data-help-good="Good: >1.5 | Great: >2.0 | Excellent: >3.0"
                                 data-help-why="Higher payoff ratios allow you to be profitable with lower win rates. A 2:1 payoff means you only need a 40% win rate to break even.">
                                <div class="metric-label">
                                    Payoff
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value" id="payoffValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Risk Per Trade" 
                                 data-help-text="The actual dollar amount you're risking on each individual trade."
                                 data-help-example="With a $5,000 account and 5% risk, you're risking $250 per trade."
                                 data-help-good="Conservative: <2% of account | Moderate: 2-5% | Aggressive: 5-10% | Very Risky: >10%"
                                 data-help-why="This controls how fast you can grow (or blow up) your account. Lower risk = slower growth but more safety. Higher risk = faster growth but higher chance of ruin.">
                                <div class="metric-label">
                                    Risk/Trade
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value text-info" id="riskValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Daily Growth Rate" 
                                 data-help-text="The expected percentage your account will grow each day based on your trading frequency and edge."
                                 data-help-example="A 5% daily growth rate means your $10,000 account should grow to $10,500 after one day of trading."
                                 data-help-good="Good: >3% | Great: >6% | Excellent: >10%"
                                 data-help-why="This shows your earning potential. Combined with compounding, high daily growth rates can lead to exponential account growth over time.">
                                <div class="metric-label">
                                    Daily Growth
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value text-warning" id="dailyGrowthValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Profit Factor" 
                                 data-help-text="Total gross profit divided by total gross loss. A measure of how much you make vs how much you lose overall."
                                 data-help-example="A profit factor of 2.5 means for every $1 you lose, you make $2.50 in profits."
                                 data-help-good="Break-even: 1.0 | Good: >2.0 | Great: >3.0 | Excellent: >4.0"
                                 data-help-why="Professional traders aim for 2.0+. Below 1.0 means you're losing money overall. This factors in both win rate and payoff ratio.">
                                <div class="metric-label">
                                    Profit Factor
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value text-danger" id="profitFactorValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Expected Profit Per Trade" 
                                 data-help-text="The average dollar amount you expect to make on each trade (winners and losers averaged together)."
                                 data-help-example="If you risk $100/trade with 60% win rate and 2:1 R:R, you make $80 on average per trade: (0.6 × $200) - (0.4 × $100) = $80"
                                 data-help-good="Depends on account size - aim for at least 1-3% of your account per trade"
                                 data-help-why="This is your actual earning power per trade. Multiply this by your trades per day to get daily profit.">
                                <div class="metric-label">
                                    $/Trade
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value text-primary" id="profitPerTradeValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Expected Daily Profit" 
                                 data-help-text="How much money you expect to make per day (Expected Profit Per Trade × Trades Per Day)."
                                 data-help-example="If you make $50/trade and take 10 trades/day, your daily profit = $500"
                                 data-help-good="Depends on goals - but should be positive! Aim for 3-10% of account value per day"
                                 data-help-why="This is your daily income target. Track this metric to see if you're meeting your profit goals.">
                                <div class="metric-label">
                                    $/Day
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value text-success" id="dailyProfitValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Kelly Criterion %" 
                                 data-help-text="The mathematically optimal percentage of your account to risk per trade for maximum long-term growth."
                                 data-help-example="If Kelly = 20%, that's the 'perfect' risk amount. But most traders use 25-50% of Kelly (so 5-10% risk) to reduce volatility."
                                 data-help-good="Full Kelly: 10-20% | Half Kelly: 5-10% (recommended) | Quarter Kelly: 2.5-5% (conservative)"
                                 data-help-why="Kelly helps you grow fastest without going broke. Using full Kelly is risky - most pros use fractional Kelly (25-50% of the calculated value).">
                                <div class="metric-label">
                                    Kelly %
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value" id="kellyValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Expected Max Loss Streak" 
                                 data-help-text="The longest streak of consecutive losing trades you're likely to experience in the given time period."
                                 data-help-example="With a 60% win rate over 1000 trades, you might see a 8-10 trade losing streak. That's normal!"
                                 data-help-good="No 'good' value - just prepare for it. Know this number so you don't panic when it happens"
                                 data-help-why="Every trader hits losing streaks. Knowing the expected max helps you: 1) Size positions properly, 2) Not quit when variance hits, 3) Recognize if something is actually wrong.">
                                <div class="metric-label">
                                    Max Loss Streak
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value text-warning" id="maxWinStreakValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Risk of Ruin" 
                                 data-help-text="The probability of losing your entire account (going broke) with your current strategy and position sizing."
                                 data-help-example="A 2% risk of ruin means there's a 2 in 100 chance you'll blow up your account. A 50% risk means you'll probably go broke!"
                                 data-help-good="Good: <5% | Great: <1% | Excellent: <0.1%"
                                 data-help-why="This is your survival metric. If this is high (>10%), reduce your risk per trade immediately. You can't make money if you go broke.">
                                <div class="metric-label">
                                    Ruin %
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value" id="ruinValue">--</div>
                            </div>
                            <div class="metric-box" 
                                 data-help-title="Sharpe Ratio" 
                                 data-help-text="A measure of risk-adjusted returns. It shows how much return you get per unit of risk (volatility) you take."
                                 data-help-example="Sharpe of 2.0 means you get 2 units of return for each unit of risk. Higher is better."
                                 data-help-good="Good: >1.0 | Great: >2.0 | Excellent: >3.0 | Elite: >4.0"
                                 data-help-why="This helps compare different strategies. A high-return strategy with huge swings might have a worse Sharpe than a steady, lower-return strategy.">
                                <div class="metric-label">
                                    Sharpe
                                    <i class="fas fa-question-circle ms-1 help-icon"></i>
                                </div>
                                <div class="metric-value" id="sharpeValue">--</div>
                            </div>
                        </div>

                        <!-- Charts Row -->
                        <div class="row g-3 mb-3">
                            <div class="col-lg-7">
                                <div class="card chart-card">
                                    <div class="card-header" data-tooltip="<strong>Account Growth Projection</strong> Shows expected account balance over time with compounding.">
                                        <i class="fas fa-chart-area"></i> Growth Projection
                                    </div>
                                    <div class="card-body p-2">
                                        <canvas id="projectionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="card chart-card">
                                    <div class="card-header" data-tooltip="<strong>Monte Carlo Simulation</strong> 10,000 simulated trading periods showing range of possible outcomes.">
                                        <i class="fas fa-dice"></i> Monte Carlo (10k trials)
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="mc-stats">
                                            <div><span>Mean:</span> <strong id="mcMean">--</strong></div>
                                            <div><span>Median:</span> <strong id="mcMedian">--</strong></div>
                                            <div><span>5%ile:</span> <strong id="mc5th">--</strong></div>
                                            <div><span>95%ile:</span> <strong id="mc95th">--</strong></div>
                                        </div>
                                        <canvas id="monteCarloChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Data Tables Row -->
                        <div class="row g-3">
                            <div class="col-lg-4">
                                <div class="card compact-table">
                                    <div class="card-header" data-tooltip="<strong>Consecutive Loss Probability</strong> Likelihood of experiencing losing streaks of various lengths.">
                                        <i class="fas fa-exclamation-triangle"></i> Loss Streaks
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="table-no-scroll">
                                            <table class="table table-sm mb-0" id="streakTable">
                                                <thead>
                                                    <tr>
                                                        <th>Streak</th>
                                                        <th>Prob</th>
                                                        <th>Freq</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Populated by JS -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="card compact-table">
                                    <div class="card-header" data-tooltip="<strong>Drawdown Scenarios</strong> Account balance after consecutive losses. <em>Red means unsustainable risk</em>">
                                        <i class="fas fa-shield-alt"></i> Drawdowns
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="table-no-scroll">
                                            <table class="table table-sm mb-0" id="drawdownTable">
                                                <thead>
                                                    <tr>
                                                        <th>Losses</th>
                                                        <th>Left</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Populated by JS -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="card compact-table">
                                    <div class="card-header" data-tooltip="<strong>Position Sizing Details</strong> Breakdown of contracts and costs per trade.">
                                        <i class="fas fa-layer-group"></i> Position Sizing
                                    </div>
                                    <div class="card-body p-2">
                                        <div id="positionSizing">
                                            <!-- Populated by JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- New Features: Win Streaks -->
                        <div class="row g-3 mt-2">
                            <div class="col-lg-4">
                                <div class="card compact-table">
                                    <div class="card-header" data-tooltip="<strong>Win Streak Probability</strong> Likelihood of consecutive winning trades.">
                                        <i class="fas fa-trophy"></i> Win Streaks
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="table-no-scroll">
                                            <table class="table table-sm mb-0" id="winStreakTable">
                                                <thead>
                                                    <tr>
                                                        <th>Streak</th>
                                                        <th>Prob</th>
                                                        <th>Freq</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Populated by JS -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="card compact-table">
                                    <div class="card-header" data-tooltip="<strong>Risk of Ruin Analysis</strong> Probability of account drawdown levels. <em>Lower percentages are safer</em>">
                                        <i class="fas fa-skull-crossbones"></i> Risk of Ruin
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="table-no-scroll">
                                            <table class="table table-sm mb-0" id="riskOfRuinTable">
                                                <thead>
                                                    <tr>
                                                        <th>DD%</th>
                                                        <th>Prob</th>
                                                        <th>Losses</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Populated by JS -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="card compact-table">
                                    <div class="card-header" data-tooltip="<strong>Account Growth Milestones</strong> Time to reach account multiples based on compounding growth.">
                                        <i class="fas fa-bullseye"></i> Account Targets
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="table-no-scroll">
                                            <table class="table table-sm mb-0" id="targetTable">
                                                <thead>
                                                    <tr>
                                                        <th>Target</th>
                                                        <th>Amount</th>
                                                        <th>Days</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Populated by JS -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- New Features: Time-Based & Recovery -->
                        <div class="row g-3 mt-2">
                            <div class="col-lg-6">
                                <div class="card compact-table">
                                    <div class="card-header" data-tooltip="<strong>Time-Based Projections</strong> Expected balance over various timeframes with compounding growth.">
                                        <i class="fas fa-calendar-alt"></i> Time-Based Projections
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="table-no-scroll">
                                            <table class="table table-sm mb-0" id="timeBasedTable">
                                                <thead>
                                                    <tr>
                                                        <th>Period</th>
                                                        <th>Trades</th>
                                                        <th>Balance</th>
                                                        <th>Growth</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Populated by JS -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-6">
                                <div class="card compact-table">
                                    <div class="card-header" data-tooltip="<strong>Drawdown Recovery Requirements</strong> Gains needed to recover from losses. <em>A 50% loss requires 100% gain!</em>">
                                        <i class="fas fa-heartbeat"></i> Recovery Analysis
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="table-no-scroll">
                                            <table class="table table-sm mb-0" id="recoveryTable">
                                                <thead>
                                                    <tr>
                                                        <th>DD%</th>
                                                        <th>Recovery</th>
                                                        <th>Wins</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Populated by JS -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Preset Modal -->
    <div class="modal fade" id="savePresetModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-bookmark"></i> Save Preset</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="savePresetForm">
                        <div class="mb-3">
                            <label class="form-label">Preset Name</label>
                            <input type="text" class="form-control" id="presetName" placeholder="My Strategy" required maxlength="20">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success btn-sm" id="confirmSavePresetBtn">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content help-modal-content">
                <div class="modal-header help-modal-header">
                    <h5 class="modal-title" id="helpModalLabel">
                        <i class="fas fa-info-circle me-2"></i>
                        <span id="helpModalTitle">Metric Information</span>
                    </h5>
                    <button type="button" class="btn-close help-modal-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body help-modal-body">
                    <p id="helpModalDescription" class="mb-0"></p>
                </div>
            </div>
        </div>
    </div>

<%- include('partials/footer') %>

<!-- Include calculation functions -->
<script src="/calculations.js"></script>
<script src="/app.js"></script>
